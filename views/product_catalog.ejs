<div class="main_wrapper">
  <% if (messages && messages.length > 0) { %>
    <% messages.forEach((message) => { %>
        <div class="alert alert-success" role="alert">
            <%= message %>
        </div>
    <% }) %>
  <% } %>

  <% if (errors && errors.length > 0) { %>
    <% errors.forEach((error) => { %>
      <div class="alert alert-danger" role="alert">
          <%= error %>
      </div>
    <% }) %>
  <% } %>
  
  <% if (delete_msg && delete_msg.length > 0) { %>
    <% delete_msg.forEach((msg) => { %>
      <div class="alert alert-danger" role="alert">
          <%= msg %>
      </div>
    <% }) %>
  <% } %>
  
  <div class="main">
    <div class="container">
      <div class="row">
        <div class="pt-5">
          <div class="col">
            <div class="row row-cols-1 row-cols-md-4 g-4 px-5">
              <% if (products && products.length > 0) { %>
                <% products.forEach((product, index) => { %>
                  <div class="col">
                    <div class="card h-100 border border-0">
                      <a href="<%= product.url %>">
                        <div class="image_wrapper">
                          <img src="<%= product.product_secure_url %>" class="card-img-top" alt="<%= product.name %>">
                        </div>
                      </a>
                      <div class="card-body p_body">
                        <div class="product_name_wrapper">
                          <p class="card-text text-capitalize p_name">
                            <a href="<%= product.url %>">
                              <%= product.name %>
                            </a>
                          </p>
                        </div>
                        <div class="row d-flex align-items-center justify-content-between">
                          <div class="col-7">
                            <p class="card-text fw-bolder price">&#x20A6;<%=" "%><%= product.price.toLocaleString('en-US') %></p>
                          </div>
                          <div class="col-5 text-end">
                            <p class="card-text fw-medium stock_status">In Stock: <%= product.number_in_stock %></p>
                          </div>
                        </div>
                        <div class="d-grid gap-2 d-md-flex justify-content-md-between pt-3 add_to_cart">
                          <!-- Modal -->
                          <div class="modal fade" id="modal-<%= index %>" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h1 class="modal-title fs-5" id="staticBackdropLabel">Confirm Deletion</h1>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                  Are you sure you want to delete this product? This action cannot be undone.
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                  <a href="/items/<%= product._id %>/delete" class="btn btn-danger">Delete</a>
                                </div>
                              </div>
                            </div>
                          </div>
                          <a href="/items/<%= product._id %>/edit" class="btn w-100 me-md-2 update_btn" type="button">Edit</a>
                          <button class="btn cancel_btn w-100" data-bs-toggle="modal" data-bs-target="#modal-<%= index %>" type="button">Delete</button>
                        </div>
                        <div class="category-wrapper mt-3">
                          <span class="card-text category" style="background-color: #D3D3D3; color: #808080;">
                            <%= product.category.name %>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                <% }) %>
              <% } else { %>
                <p>No product found!</p>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
